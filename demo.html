<!doctype html>
<html>
    <head>
        <title>Ribs demo</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script type="text/javascript" src="https://raw.github.com/joestelmach/laconic/master/laconic.js"></script>
        <script type="text/javascript" src="http://documentcloud.github.com/underscore/underscore.js"></script>
        <script type="text/javascript" src="http://backbonejs.org/backbone.js"></script>
        <script type="text/javascript" src="ribs.js"></script>

        <link rel="stylesheet" href="ribs.css" />

        <style type="text/css">
            .ribs .name {
                width: 332px;
            }
            .ribs .item.done .name {
                text-decoration: line-through;
            }
            .ribs .item:not(.done) .completed {
                display: none;
            }
            .ribs .item .completed {
                padding: 1px 0 0 4px;
                color: green;
            }
            .ribs .item.done .button {
                display: none;
            }
        </style>

        <script type="text/javascript">

            $(function() {

                // build a todos collection with some bootstrap data
                var todos = new Backbone.Collection([ 
                    { name: "Go to the gym", completed: false },
                    { name: "Send a post card to Elaine", completed: false }
                ]);

                // build a Ribs list for the todos
                var todos_view = new Ribs.List({
                    collection: todos,
                    itemName: "todo",
                    jumpkey: "t",

                    // this set of attributes determines what is shown
                    displayAttributes: [
                        {
                            label: "",
                            field: "name"
                        },
                        { 
                            label: "",
                            field: "completed", 
                            // convert boolean to a check mark
                            map: function(complete) { 
                                return complete ? "✓" : "";
                            }
                        }
                    ],

                    // we're providing several different flavors of action here
                    actions: [
                        // first we have a standard 'New' action.
                        {
                            // this label will show up in the keyboard help pane
                            label: "New TODO",
                            // this overrides the label shown on the button
                            batchLabel: "New",
                            // hotkey available when focus is within ribs object
                            hotkey: "N",
                            // no minimum selection criterea
                            min: 0,
                            // this is called on click, or when hotkey is hit
                            // remember: scope is the `Ribs.List` instance
                            activate: function() {
                                // ask user for some text
                                var name = prompt("What do you need to do?");
                                if (name && name !== "") {
                                    // add it to the collection
                                    model = this.collection.push({ name: name, completed: false});
                                    // give keyboard focus to new item
                                    model.trigger("stealfocus");
                                }
                            }
                        },
                        {
                            label: "Complete",
                            inlineLabel: "✓",
                            inline: true,
                            batch: false,
                            hotkey: "c",
                            activate: function(selected, listItem) {
                                if (listItem !== undefined){
                                    // if triggered inline
                                    listItem.model.set("completed", true);
                                    listItem.model.trigger("stealfocus");
                                } else { 
                                    // if triggered by batch
                                    _.each(selected, function(model) {
                                        model.set("completed", true);
                                    });
                                }
                            }
                        },
                        // this action is completely hidden from the rendered 
                        // Ribs list. However It is visible on the keyboard
                        // bindings pane and can be activated by hotkey
                        {
                            label: "Uncomplete",
                            batch: false,
                            hotkey: "u",
                            min: 0,
                            activate: function(selected, listItem) {
                                if (listItem !== undefined){ // if triggered inline
                                   listItem.model.set("completed", false);
                                   listItem.model.trigger("stealfocus");
                                } else { // if triggered by batch
                                    _.each(selected, function(model) {
                                        model.set("completed", false);
                                    });
                                }
                            }
                        },
                        {
                            label: "Clear selected",
                            batchLabel: "Clear",
                            hotkey: "C",
                            activate: function(selected) {
                                c = this.collection;
                                _.each(selected, function(model) {
                                    c.remove(model);
                                });
                            }
                        }
                    ],

                    // we're overriding the default item view just to get the
                    // strike-thru look happening for completed items
                    itemView: Ribs.ListItem.extend({
                        initialize: function(options) {
                            var t = this;
                            this.model.on("change", function(){
                                t.$el.toggleClass("done", t.model.get("completed"));
                            });
                        }
                    })

                });

                todos_view.render();

                $("body").append(todos_view.el);
                
            });

        </script>

    </head>
    <body>
        <h1>Ribs demo</h1>
    </body>
</html>
